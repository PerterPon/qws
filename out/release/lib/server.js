// Generated by CoffeeScript 1.6.2
var EventEmitter, Message, Server, os,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Message = require('./message').Message;

EventEmitter = require('events').EventEmitter;

os = require('options-stream');

Server = (function(_super) {
  __extends(Server, _super);

  function Server(server, options) {
    var _this = this;

    this.server = server;
    this.options = os({
      url: '/ws',
      deflate: true,
      min_deflate_length: 32
    }, options);
    server.on('upgrade', function(req, socket) {
      return _this.emit('connect', new Message(req, socket, _this.options));
    });
  }

  return Server;

})(EventEmitter);

exports.Server = Server;
